FROM node:14

RUN mkdir -p /usr/src/node-api
WORKDIR /usr/src/node-api
COPY . .

ENV NODE_ENV=production
ENV NODE_APP_CORS_URL=http://localhost:3000
ENV NODE_APP_AZURE_CONTAINER=test1
ENV NODE_APP_AZURE_STORAGEACCOUNT=iretest
ENV NODE_APP_AZURE_STORAGEACCOUNTPW=ih4wtT3oxEkWnuWKGLLTVywajiKEK30Ev7WX27HOVo6k7cAIqY4f5qPIWQH7LVrxS71KTGXYTbJisGLCmWzN9g==
ENV NODE_APP_AZURE_STORAGEURI=https://iretest.blob.core.windows.net
ENV NODE_APP_UPLOADMAXCOUNT=12
ENV NODE_APP_LIMITFILESIZE=1000000000

RUN npm install --production && npm run build:prod

EXPOSE 3000

CMD [ "npm", "start" ]
